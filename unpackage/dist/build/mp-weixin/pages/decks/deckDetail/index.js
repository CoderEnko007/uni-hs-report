(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/decks/deckDetail/index"],{2059:function(e,t,a){"use strict";var n=a("9e8a"),i=a.n(n);i.a},"3c32":function(e,t,a){"use strict";a.r(t);var n=a("bc86"),i=a("aa09");for(var o in i)"default"!==o&&function(e){a.d(t,e,function(){return i[e]})}(o);a("2059");var c=a("2877"),r=Object(c["a"])(i["default"],n["a"],n["b"],!1,null,"19b14ab2",null);t["default"]=r.exports},8004:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("a34a")),i=s(a("eaab")),o=a("2f62"),c=a("6110"),r=l(a("7143"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};n.get||n.set?Object.defineProperty(t,a,n):t[a]=e[a]}return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t,a,n,i,o,c){try{var r=e[o](c),s=r.value}catch(l){return void a(l)}r.done?t(s):Promise.resolve(s).then(n,i)}function h(e){return function(){var t=this,a=arguments;return new Promise(function(n,i){var o=e.apply(t,a);function c(e){d(o,n,i,c,r,"next",e)}function r(e){d(o,n,i,c,r,"throw",e)}c(void 0)})}}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){f(e,t,a[t])})}return e}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var g,p=function(){return a.e("components/DeckCards").then(a.bind(null,"6633"))},m=function(){return a.e("components/FooterMenu").then(a.bind(null,"19a9"))},k=function(){return a.e("components/toast").then(a.bind(null,"7145"))},D=function(){return a.e("components/NavBar").then(a.bind(null,"661f"))},w=function(){return a.e("components/WinRateBoard").then(a.bind(null,"5969"))},v=function(){return a.e("components/AddBubble").then(a.bind(null,"7209"))},x=function(){return a.e("components/floatBtnGroup").then(a.bind(null,"e3ac"))},y=function(){return a.e("components/compareDeckModal").then(a.bind(null,"7ac9"))},C=function(){return a.e("components/SpinKit").then(a.bind(null,"14a4"))},b={background_img:"",deck_name:"",cname:"",dust_cost:null,win_rate:null,game_count:null,real_game_count:null,duration:null,turns:null,card_list:"",clazzCount:"",rarityCount:"",statistic:"",faction_win_rate:""},I={components:{NavBar:D,DeckCards:p,FooterMenu:m,WinRateBoard:w,AddBubble:v,floatBtnGroup:x,compareDeckModal:y,ZanToast:k,SpinKit:C},data:function(){return{recordID:"",deckID:"",trending:!1,collected:!1,collectingFlag:!1,deckMode:"Standard",bannerImg:null,deckDetail:Object.assign({},b),dustImage:i.default.image.dustImage,costChartData:{xAxis:["0","1","2","3","4","5","6","7+"],yAxis:[],min:0,max:15},costUChartData:{categories:["0","1","2","3","4","5","6","7+"],series:[{data:[],color:"#433E88"}]},typeChartData:[],rarityChartData:[],rarityColor:[],winrateChartData:[],selectWinRate:{name:"",value:""},deckCollected:!1,deckChecked:!1,showArchetype:!1,canvasHeight:270,canvasWidth:165,cWidth:"",cHeight:"",pixelRatio:1}},computed:u({},(0,o.mapGetters)(["decksName","navHeight","userInfo","showBubble","compareDeck1","compareDeck2"]),{badgeCount:function(){var e=0;return e+=this.compareDeck1?1:0,e+=this.compareDeck2?1:0,e},genFactionIcon:function(){if(this.deckDetail.faction)return i.default.faction[this.deckDetail.faction].image},gameCount:function(){return this.deckDetail.real_game_count?this.deckDetail.real_game_count:this.deckDetail.game_count},adsOpenFlag:function(){return i.default.adsOpenFlag}}),methods:{resetPageData:function(){this.deckDetail=Object.assign({},b),this.bannerImg=null,this.costChartData={xAxis:["0","1","2","3","4","5","6","7+"],yAxis:[]},this.typeChartData=[],this.rarityChartData=[],this.winrateChartData=[],this.selectWinRate={name:"",value:""},this.deckCollected=!1,this.showArchetype=!1},genDeckData:function(){var e=h(n.default.mark(function e(){var t,a,o,r,s,l,d,h,u,f=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return wx.showNavigationBarLoading(),t={},this.recordID?t={recordID:this.recordID}:this.deckID&&(t={deckID:this.deckID}),t.mode=this.deckMode,e.next=6,(0,c.getDeckDetail)(t,this.trending,this.collected);case 6:if(a=e.sent,a){for(l in this.checkDeckCollected(),this.deckDetail=a,o=this.decksName.filter(function(e){return e.ename===f.deckDetail.deck_name}),o.length>0?this.deckDetail.cname=o[0].cname:this.deckDetail.cname=this.deckDetail.deck_name,this.getArchetype(),this.bannerImg=i.default.faction[this.deckDetail["faction"]].bgImage1,this.costChartData.yAxis=JSON.parse(this.deckDetail.statistic),r=Math.max.apply(null,this.costChartData.yAxis),this.costChartData.max=5-r%10>0?r+5-r%10:r+10-r%10,this.costChartData=JSON.stringify(this.costChartData),this.costUChartData.series[0].data=JSON.parse(this.deckDetail.statistic),this.showColumn("canvasColumn",this.costUChartData),this.typeChartData=[],s=JSON.parse(this.deckDetail.clazzCount),s)s.hasOwnProperty(l)&&this.typeChartData.push({name:l.toLowerCase(),cname:i.default.type[l.toUpperCase()].name,value:s[l]});for(u in this.rarityChartData=[],d=JSON.parse(this.deckDetail.rarityCount),h={name:"",cname:"基础/普通",value:0,color:i.default.rarity["free"].color},this.rarityColor=[],d)d.hasOwnProperty(u)&&("free"===u.toLowerCase()||"common"===u.toLowerCase()?h.value+=d[u]:this.rarityChartData.push({name:u.toLowerCase(),cname:i.default.rarity[u.toLowerCase()].name,value:d[u],color:i.default.rarity[u.toLowerCase()].color}));this.rarityChartData.unshift(h),this.winrateChartData=JSON.parse(this.deckDetail.faction_win_rate),this.winrateChartData=this.winrateChartData.map(function(e){return e.win_rate=parseFloat(e.win_rate).toFixed(1),e}),wx.hideNavigationBarLoading(),wx.stopPullDownRefresh()}else wx.showModal({title:"提示",content:"抱歉，暂未收录该卡组",showCancel:!1,success:function(e){wx.navigateBack()}});case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getArchetype:function(){var e=this;this.deckDetail.deck_name&&(0,c.getArchetypeDetail)({name:this.deckDetail.deck_name}).then(function(t){e.showArchetype=!!t})},handleCardClick:function(e){wx.navigateTo({url:"/pages/cards/cardDetail/index?id=".concat(e.dbfId)})},copyDeckCode:function(){wx.setClipboardData({data:this.deckDetail.deck_code,success:function(e){wx.showToast({title:"复制成功"})}})},handleWinRateBarClick:function(e){for(var t in i.default.faction)i.default.faction.hasOwnProperty(t)&&i.default.faction[t].shortName===e.name&&(this.selectWinRate.name=i.default.faction[t].name);this.selectWinRate.value=e.value},handleCollection:function(){var e=this;if(!this.collectingFlag)if(this.collectingFlag=!0,wx.showLoading({title:"请稍等",mask:!0}),this.deckCollected){var t={collection_id:this.deckDetail.id,user_id:this.userInfo.id};this.$store.dispatch("cancelCollectedDeck",t).then(function(t){wx.hideLoading(),e.$refs.btnGroup.deactiveCollectIcon(),e.deckCollected=!1,e.collectingFlag=!1}).catch(function(e){wx.hideLoading(),console.log(e)})}else if(this.userInfo.id){var a={query:{deck_id:this.deckDetail.deck_id,user_id:this.userInfo.id,trending:this.trending},deckDetail:this.deckDetail};this.$store.dispatch("addCollectedDeck",a).then(function(t){wx.hideLoading(),wx.showToast({title:"收藏成功",icon:"success",duration:2e3}),e.collectingFlag=!1,e.$refs.btnGroup.activeCollectIcon(),e.deckCollected=!0}).catch(function(e){wx.hideLoading(),console.log(e)})}else this.collectingFlag=!1,this.toast.showZanToast({title:"请登录",icon:"fail"})},checkDeckCollected:function(){var e=this;if(this.userInfo.id){var t=this.$store.state.cards.collectedDecks.filter(function(t){return t.id===e.recordID});this.deckCollected=t.length>0}this.deckChecked=!0},gotoArchetypeDetail:function(){wx.navigateTo({url:"/pages/decks/archetypeDetail/index?name=".concat(this.deckDetail.deck_name)})},handleExport:function(){wx.showLoading({title:"图片生成中",mask:!0}),this.saveImageToPhotos()},saveImageToPhotos:function(){var e=this;wx.getSetting({success:function(t){console.log("getSetting",t),t.authSetting["scope.writePhotosAlbum"]?(console.log("PhotosAlbum已授权"),e.drawDeckCanvas()):wx.authorize({scope:"scope.writePhotosAlbum",success:function(){e.drawDeckCanvas()},fail:function(){wx.hideLoading(),wx.showModal({content:"您尚未打开相册使用权限，是否去设置打开？",confirmColor:"#433e88",success:function(e){e.confirm&&wx.openSetting({success:function(e){console.log(e.authSetting)}})}})}})},fail:function(e){wx.hideLoading(),wx.showToast({title:"图片保存失败",icon:"none",duration:2e3})}})},drawDeckCanvas:function(){var e=h(n.default.mark(function e(){var t,a,o,c,r,s,l,d,h,u,f,g,p,m,k,D,w,v,x,y,C,b;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("drawDeckCanvas"),t={common:"#5e5e5e",rare:"#1768c6",epic:"#705dc7",legendary:"#f5a623"},a={},!this.deckDetail.card_list){e.next=24;break}for(a=JSON.parse(this.deckDetail.card_list),o=!0,c=!1,r=void 0,e.prev=8,s=a[Symbol.iterator]();!(o=(l=s.next()).done);o=!0)d=l.value,d["img"]=(0,i.iFanrTileImageURL)(d.tile),"LEGENDARY"===d.rarity&&(d["count"]="★");e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](8),c=!0,r=e.t0;case 16:e.prev=16,e.prev=17,o||null==s.return||s.return();case 19:if(e.prev=19,!c){e.next=22;break}throw r;case 22:return e.finish(19);case 23:return e.finish(16);case 24:h=wx.createCanvasContext("deck-pic"),u=30,f=52,g=26,p=u*a.length-1,this.canvasHeight=p+f+g+2,h.setFillStyle("#000"),h.fillRect(0,0,this.canvasWidth,this.canvasHeight),h.save(),h.setFillStyle("#2C3E50"),h.fillRect(0,0,this.canvasWidth,f-2),h.restore(),h.drawImage(i.default.faction[this.deckDetail.faction].image,7,7,38,38),h.save(),h.font="normal bold 15px sans-serif",h.textAlign="left",h.setFillStyle("#fff"),h.fillText(this.deckDetail.cname,52,23),h.restore(),h.save(),h.drawImage(this.dustImage,52,30,10,14),h.font="normal normal 12px sans-serif",h.setFillStyle("#fff"),h.fillText(this.deckDetail.dust_cost,64,42),m=this.deckDetail.mode?this.deckDetail.mode:"Standard",h.drawImage(i.default.deckModeImg(m),this.canvasWidth-50,30,15,15),k="",k="wild"===m.toLowerCase()?"狂野":"标准",h.fillText(k,this.canvasWidth-32,42),h.restore(),console.log("头部绘制完成"),D=h.createLinearGradient(27,0,136,0),D.addColorStop(0,"#313109"),D.addColorStop(.2,"#313131"),D.addColorStop(.83,"rgba(49,49,49,00)"),D.addColorStop(1,"rgba(49,49,49,00)"),w=getCurrentPages(),e.t1=n.default.keys(a);case 62:if((e.t2=e.t1()).done){e.next=105;break}if(v=e.t2.value,!a.hasOwnProperty(v)){e.next=103;break}h.save(),h.beginPath(),x=t.common,e.t3=a[v].rarity,e.next="RARE"===e.t3?71:"EPIC"===e.t3?73:"LEGENDARY"===e.t3?75:77;break;case 71:return x=t.rare,e.abrupt("break",78);case 73:return x=t.epic,e.abrupt("break",78);case 75:return x=t.legendary,e.abrupt("break",78);case 77:x=t.common;case 78:return h.setFillStyle(x),h.fillRect(0,f+v*u,27,29),h.font="normal bold 14px sans-serif",h.textAlign="center",h.setFillStyle("#fff"),h.fillText(a[v].cost,14,f+v*u+20),h.closePath(),h.restore(),e.next=88,(0,i.getImageInfoAsync)(a[v].img);case 88:if(y=e.sent,"pages/decks/deckDetail/index"===w[w.length-1].route){e.next=92;break}return console.log("not canvas page"),e.abrupt("return");case 92:C=y.height/29,1!==a[v].count?h.drawImage(y.path,30,0,100*C,y.height,43,f+v*u,100,29):h.drawImage(y.path,0,0,122*C,y.height,43,f+v*u,122,29),1!==a[v].count&&(h.save(),h.setFillStyle("#313131"),h.fillRect(143,f+v*u,22,29),h.font="normal bolder 13px sans-serif",h.textAlign="center",h.setFillStyle("#f4d442"),h.fillText(a[v].count,154,f+v*u+19),h.restore()),h.fillStyle=D,h.fillRect(27,f+v*u,136,29),h.save(),h.font="normal bold 12px sans-serif",h.textAlign="left",h.setFillStyle("#fff"),h.fillText(a[v].cname,32,f+v*u+19),h.restore();case 103:e.next=62;break;case 105:h.save(),h.setFillStyle("#2C3E50"),h.fillRect(0,p+f+2,this.canvasWidth,g),h.font="normal normal 12px sans-serif",h.textAlign="center",h.textBaseline="middle",h.setFillStyle("#fff"),h.fillText("微信小程序：炉石传说情报站",this.canvasWidth/2,p+f+g/2+2),h.restore(),b=this,h.draw(!1,function(e){console.log(e),setTimeout(function(){b.saveCanvasImg()},1e3)});case 116:case"end":return e.stop()}},e,this,[[8,12,16,24],[17,,19,23]])}));function t(){return e.apply(this,arguments)}return t}(),saveCanvasImg:function(){var e=getCurrentPages();if("pages/decks/deckDetail/index"===e[e.length-1].route){var t=164250/wx.getSystemInfoSync().windowWidth,a=219*this.canvasHeight/this.canvasWidth*750/wx.getSystemInfoSync().windowWidth;wx.canvasToTempFilePath({canvasId:"deck-pic",destWidth:t,destHeight:a,quality:1,success:function(e){wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){wx.hideLoading(),wx.showToast({title:"图片已保存到相簿",duration:2e3})},fail:function(e){wx.hideLoading(),wx.showToast({title:"图片保存失败",icon:"none",duration:2e3})}})},fail:function(e){console.log("error",e),wx.hideLoading(),wx.showToast({title:"图片生成失败",icon:"none",duration:2e3})}})}},openCompareDeckModal:function(){this.$refs.cDeckModal.showModal()},handleClearDeckModal:function(){this.$store.commit("clearDecks")},handleDeckCompare:function(){console.log("开始对比卡组"),console.log(this.compareDeck1,this.compareDeck2),wx.navigateTo({url:"/pages/decks/compareDeck/index"})},handleAddDeck1:function(){this.$store.commit("setFirstDeck",this.deckDetail)},handleAddDeck2:function(){this.$store.commit("setSecondDeck",this.deckDetail)},showColumn:function(e,t){console.log(t,this.cWidth,this.cHeight),new r.default({$this:g,canvasId:e,type:"column",legend:!1,fontSize:11,background:"#FFFFFF",pixelRatio:g.pixelRatio,animation:!1,categories:t.categories,series:t.series,yAxis:{max:10,disabled:!0},width:g.cWidth*g.pixelRatio,height:g.cHeight*g.pixelRatio,extra:{column:{type:"group",width:g.cWidth*g.pixelRatio*.45/t.categories.length}}})}},mounted:function(){var e=h(n.default.mark(function e(){var t=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(setTimeout(function(){t.$store.commit("setShowBubbleFlag",!1)},4e3),this.toast=(0,i.getComponentByTag)(this,"_toast"),this.recordID=this.$root.$mp.query.id,this.deckID=this.$root.$mp.query.deckID,this.deckMode=this.$root.$mp.query.mode?this.$root.$mp.query.mode:"Standard",0!==this.decksName.length){e.next=9;break}return e.next=8,this.$store.dispatch("getDecksName");case 8:this.decksName=e.sent;case 9:return this.trending=!!this.$root.$mp.query.trending,this.collected=!!this.$root.$mp.query.collected,e.next=13,this.genDeckData();case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onLoad:function(){g=this,this.cWidth=e.upx2px(750),this.cHeight=e.upx2px(300)},onPullDownRefresh:function(){this.costChartData=JSON.parse(this.costChartData),this.genDeckData()},onShareAppMessage:function(e){var t="";return this.recordID?"/pages/decks/deckDetail/index?recordID=".concat(this.recordID):this.deckID&&"/pages/decks/deckDetail/index?deckID=".concat(this.deckID),{title:this.deckDetail.cname,path:t}}};t.default=I}).call(this,a("543d")["default"])},"9e8a":function(e,t,a){},aa09:function(e,t,a){"use strict";a.r(t);var n=a("8004"),i=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);t["default"]=i.a},bc86:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},i=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return i})}},[["a17a","common/runtime","common/vendor"]]]);